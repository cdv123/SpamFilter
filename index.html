<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <link rel="stylesheet" href="style.css" />
    <meta charset="UTF-8">
    <!-- pyscript library-->
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- d3 library-->
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <title>Analysis of different methods for spam classification</title>
    <py-config>
        packages= ["numpy","matplotlib"]
        [[fetch]]
        from = "./"
        files =["numpyNetwork.py", "word2vec.py", "simplifyDataset.py", "numpyNetwork.py", "oneHot.py","naiveBayesMethod.py"]
    </py-config>
</head>
<body>
    <h1>Spam Detection</h1>
    <label for="msg-input" id = "msg-label">Input spam (or ham) message here:</label>
    <input type="text" id = "msg-input">
    <button onclick="showX()" id = "Evaluate">Evaluate Message</button>
    <div id = "modal-results">
        <div id="my_dataviz"></div>
        <button class = "close-btn" id = "close-results">X</button>
        <div id = "results-chart"></div>
    </div> 
    <button id = "settings-btn"> Settings</button>
    <div id = "config">
        <button class = "close-btn" id = "close-config">X</button>
        <p class = "line">
            <p class = "model">Naive Bayes Model:</p>
            <p class = "epoch-num">Prior spam probability</p>
            <input class ="number-input" type="number" name="" value="0.50">
            <p class = "setting">Words Used</p>
            <input class ="number-input" type="number" name="" value="1000">
            <button id = "btn-naive-bayes" class = "confirm-settings">Confirm and Retrain Naive Bayes</button>
        </p>
        <p class = "line">
            <p class = "model">One-Hot Model:</p>
            <p class = "epoch-num">Vector Size:</p>
            <input class ="number-input" type="number" name="" value="300">
            <p class = "epoch-num">Number of epochs:</p>
            <input class ="number-input" type="number" name="" value="20">
            <p class = "setting">Learning Rate:</p>
            <input class = "number-input" type="number" name="" value="0.03">
            <p class = "add-hidden">Add hidden layer</p>
            <input id = "checkbox-one-hot" class = "hidden-layer" type="checkbox" name="" value="">
            <p class = "hidden-nodes-num hidden-one-hot">Number of nodes in hidden layer:</p>
            <input class = "hidden-nodes hidden-one-hot" type="" name="" value="9">
            <button id = "btn-one-hot" class = "confirm-settings">Confirm and Retrain One-Hot</button>
        </p>
        <p class = "line">
            <p class = "model">Word2Vec Model:</p>
            <p class = "epoch-num">Number of epochs:</p>
            <input class = "number-input" type="number" name="" value="20">
            <p class = "setting">Learning Rate:</p>
            <input class = "number-input" type="number" name="" value="0.03">
            <p class = "add-hidden">Add hidden layer</p>
            <input id = "checkbox-word2vec" class = "hidden-layer" type="checkbox" name="" value="">
            <p class = "hidden-nodes-num hidden-word2vec">Number of nodes in hidden layer:</p>
            <input class = "hidden-nodes hidden-word2vec" type="" name="" value="9">
            <button id = "btn-word2vec" class = "confirm-settings">Confirm and Retrain Word2Vec</button>
        </p>
 
    </div>
    <py-script>
        import numpy as np
        from word2vec import sentenceEmbedding, useEmbedding, messageEmbedding
        from oneHot import oneHotEncode,getMostCommonWords,oneHotEncode2
        from numpyNetwork import neuralNetwork,getOutput, sigmoid
        from simplifyDataset import loadSMS,convertSpamToBinary,loadMessage
        from naiveBayesMethod import trainModel, analyseMsg
        from pyodide.http import open_url
        from pyodide.http import to_js
        import js
        from pyodide.ffi import create_proxy
        import matplotlib.pyplot as plt
        trainingText = open_url("https://raw.githubusercontent.com/cdv123/SpamFilter/webversion/Dataset/SMSSpamCollection.txt")
        customEmbedding = open_url("https://raw.githubusercontent.com/cdv123/SpamFilter/webversion/Dataset/customEmbedding.txt")
        trainingText = trainingText.read()
        customEmbedding = customEmbedding.read()
        trainingData,spamData = loadSMS(trainingText)
        spamData = convertSpamToBinary(spamData)
        spamData2 = spamData[:]
        global oneHotWeights,oneHotBias
        global word2vecWeights,word2vecBias
        global wordProbHam,wordProbSpam
        embeddingDict = useEmbedding(customEmbedding)
        def oneHotTrain(trainingData,spamData,vectorSize,epochs,lr):
            mostCommonWords = getMostCommonWords(trainingData,vectorSize)
            oneHotData = list(oneHotEncode(trainingData,mostCommonWords).values())
            resultArr = neuralNetwork(oneHotData,spamData,lr,epochs)
            global oneHotWeights
            oneHotWeights = resultArr[0]
            global oneHotBias
            oneHotBias = resultArr[1]
        def naiveBayesTrain(trainingData,spamData,wordNum):
            resultArr = trainModel(trainingData,spamData,wordNum)
            global wordProbHam 
            wordProbHam= resultArr[0]
            global wordProbSpam
            wordProbSpam = resultArr[1]
        def word2vecTrain(trainingData,spamData,epochs,lr):
            trainSentences = sentenceEmbedding(trainingData,spamData,embeddingDict,100)
            resultArr = neuralNetwork(trainSentences,spamData,lr,epochs)
            global word2vecWeights
            word2vecWeights = resultArr[0]
            global word2vecBias
            word2vecBias = resultArr[1]
            error = resultArr[2]
            return error
        def useOneHot(weights,bias,message):
            message = loadMessage(message)
            oneHotData = oneHotEncode2(message,mostCommonWords)
            return sigmoid(getOutput(oneHotData,weights,bias))
        def useWord2Vec(weights,bias,message):
            message = loadMessage(message)
            wordVector = messageEmbedding(message,embeddingDict,100)
            return sigmoid(getOutput(wordVector,weights,bias))
        naiveBayesTrain(trainingData,spamData,1000)
        error = word2vecTrain(trainingData,spamData2,20,0.003)
        oneHotTrain(trainingData,spamData,100,20,0.003)
        fig,ax = plt.subplots()
        ax.plot(error,range(20))
        display(fig)
    </py-script>
    <script src = "script.js"></script>
</body>
</html>